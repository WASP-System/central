

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>WASP Developers Guide &mdash; Wasp System 0.1.0-RELEASE documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1.0-RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Wasp System 0.1.0-RELEASE documentation" href="#" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="#">
          <span>Wasp System 0.1.0-RELEASE documentation</span></a></h1>
        <h2 class="heading"><span>WASP Developers Guide</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="wasp-developers-guide">
<h1>WASP Developers Guide<a class="headerlink" href="#wasp-developers-guide" title="Permalink to this headline">¶</a></h1>
<p>Contents:</p>
<div class="toctree-wrapper compound">
<ul class="simple">
</ul>
</div>
<div class="section" id="preface">
<h2>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h2>
<p>Massively parallel sequencing is massively parallel.</p>
</div>
<div class="section" id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>What you need to get started.</p>
<p>Hardware dependencies</p>
<ul class="simple">
<li>Web Server</li>
<li>Compute Cluster</li>
<li>Filesystem</li>
</ul>
<p>Software dependencies</p>
<ul class="simple">
<li>Linux</li>
<li>Grid scheduler
* Sun/Oracle Grid Engine or PBS/Torque</li>
<li>Java</li>
<li>Maven</li>
<li>Tomcat</li>
<li>MySQL (or MariaDB)</li>
<li>Git</li>
</ul>
<p>Detailed description of operating system requirements and scheduler.
Detailed description of dependencies, where necessary.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>What you need to get WASP installed.</p>
<div class="section" id="getting-the-wasp-system-source-code-from-github">
<h3>Getting the WASP System Source Code from GitHub<a class="headerlink" href="#getting-the-wasp-system-source-code-from-github" title="Permalink to this headline">¶</a></h3>
<p>Make sure you have Git on your server (obtain from <a class="reference external" href="http://git-scm.com">http://git-scm.com</a>) and obtain the latest WASP System code from <a class="reference external" href="https://github.com/WASP-System">https://github.com/WASP-System</a>.
Please make sure you understand the importance of line endings in Git and adjust your setting accordingly: <a class="reference external" href="http://help.github.com/articles/dealing-with-line-endings">http://help.github.com/articles/dealing-with-line-endings</a>
We provide a script to help clone and install the main components to speed up the installation process (see <a class="reference internal" href="installation.html#installing"><em>Installing, Building and Deploying WASP</em></a>).</p>
<p>After cloning the WASP System source code, you’ll notice the project contains many folders. Most of these represent modules of the system, wrapped up into individual Maven projects:</p>
<table border="1" class="docutils" id="folders">
<caption>Wasp System project folder contents</caption>
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Subfolder</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>db</td>
<td>Contains database initialization files</td>
</tr>
<tr class="row-odd"><td>wasp-parent</td>
<td>Hosts a parent.pom that defines common dependencies and versions required by other components. Maven Project.</td>
</tr>
<tr class="row-even"><td>wasp-web</td>
<td>The WASP System webapp. Maven/Spring project. Builds a war file for Tomcat7 deployment.</td>
</tr>
<tr class="row-odd"><td>wasp-file</td>
<td>File download webapp for delivering files to users.  Maven/Spring project. Builds a war file for Tomcat7 deployment.</td>
</tr>
<tr class="row-even"><td>wasp-core</td>
<td>Spring component containing core code. Maven/Spring project. Builds a jar.</td>
</tr>
<tr class="row-odd"><td>wasp-cli</td>
<td>Used to run wasp analysis jobs from the command line. Maven/Spring project. Builds a jar and wrapper script.</td>
</tr>
<tr class="row-even"><td>wasp-config</td>
<td>local configuration e.g. database and email sever details etc. Maven/Spring project. Builds a jar.</td>
</tr>
<tr class="row-odd"><td>wasp-daemon</td>
<td>Spring component that runs WASP System task management flows and pipeline flows.</td>
</tr>
<tr class="row-even"><td>wasp-exec</td>
<td>Builds a jar to execute the wasp-daemon component. Maven/Spring project.</td>
</tr>
<tr class="row-odd"><td>wasp-plugin</td>
<td>Contains a .pom file that serves as a parent for .pom files in all plugin projects. Maven project.</td>
</tr>
<tr class="row-even"><td>wasp-interface</td>
<td>location for interfaces used across projects. Maven/Spring project. Builds a jar</td>
</tr>
<tr class="row-odd"><td>wasp-tomcat-classloader</td>
<td>Extends WebappClassLoader to allow loading of classes from the waspPlugins folder in the Tomcat base folder. Maven project. Builds a jar.</td>
</tr>
<tr class="row-even"><td>wasp-doc</td>
<td>Wasp System documentation</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="setting-up-the-server-linux">
<h3>Setting up the Server (Linux)<a class="headerlink" href="#setting-up-the-server-linux" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Download the latest versions of  the following software packages and install according to the provider’s instructions:</p>
<ul class="simple">
<li>Apache Tomcat7 (<a class="reference external" href="http://tomcat.apache.org">http://tomcat.apache.org</a>)</li>
<li>Apache Maven3(<a class="reference external" href="http://maven.apache.org">http://maven.apache.org</a>)</li>
<li>Oracle Java SE 6 (<a class="reference external" href="http://www.oracle.com">http://www.oracle.com</a>) (OpenJDK is currently in testing and appears to work well)</li>
<li>MySQL Community Server (<a class="reference external" href="http://www.mysql.com/downloads/mysql">http://www.mysql.com/downloads/mysql</a>)</li>
</ul>
</li>
<li><p class="first">Add environment variables to your user profile and set the values to the paths of the installations above:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ANT_HOME</span></tt></li>
<li><tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt></li>
<li><tt class="docutils literal"><span class="pre">CATALINA_HOME</span></tt></li>
<li><tt class="docutils literal"><span class="pre">MAVEN_HOME</span></tt></li>
</ul>
</li>
<li><p class="first">Then set the PATH environment variable to point to the relevant binaries.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">PATH=$JAVA_HOME/bin:$ANT_HOME/bin:$MAVEN_HOME/bin:$PATH</span></tt></li>
</ul>
<p>E.g. in a typical Linux setup using bash, your .bashrc file should contain something similar to this:</p>
<div class="highlight-python"><pre>export ANT_HOME=/opt/ant
export JAVA_HOME=/usr/java/latest
export CATALINA_HOME=/usr/local/tomcat/tomcat/current
export WASP_HOME=$HOME/waspSystem
export MAVEN_HOME=/opt/maven/current
export PATH=$JAVA_HOME/bin:$ANT_HOME/bin:$MAVEN_HOME/bin:$PATH</pre>
</div>
</li>
</ol>
</div>
<div class="section" id="tomcat-7-setup">
<h3>Tomcat 7 setup<a class="headerlink" href="#tomcat-7-setup" title="Permalink to this headline">¶</a></h3>
<ol class="arabic">
<li><p class="first">Using your favorite editor, create a new file in folder <tt class="docutils literal"><span class="pre">$CATALINA_HOME/bin</span></tt>
called <tt class="docutils literal"><span class="pre">setenv.sh</span></tt>, and put the following text into it and save:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">CATALINA_HOME</span><span class="o">=</span><span class="s">&quot;/usr/local/tomcat/tomcat&quot;</span>
<span class="n">JAVA_OPTS</span><span class="o">=</span><span class="s">&quot;-Xms128m -Xmx512m -XX:PermSize=128m -XX:MaxPermSize=512m&quot;</span>
<span class="n">JAVA_HOME</span><span class="o">=</span><span class="s">&quot;/usr/java/latest&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Open <tt class="docutils literal"><span class="pre">$CATALINA_HOME/conf/tomcat-users.xml</span></tt> using your favorite editor and add the
following (replacing placeholders ‘myGuiPass’ and ‘myScriptPass’ with your own choice of
passwords:</p>
<div class="highlight-python"><pre>&lt;/tomcat-users&gt;
   &lt;role rolename="manager-gui"/&gt;
   &lt;user username="tomcat" password="myGuiPass" roles="manager-gui"/&gt;
   &lt;role rolename="manager-script"/&gt;
   &lt;user username="tomcat-script" password="myScriptPass" roles="manager-script"/&gt;
 &lt;/tomcat-users&gt;</pre>
</div>
<p>The manager-script account is used to deploy The WASP System using Maven. The managergui
account can be used to manage your tomcat installation at <a class="reference external" href="http://localhost:8080/manager">http://localhost:8080/manager</a>.
To deploy wasp using Maven, the following complementary information about the server needs
to be added to your local maven configuration as follows:</p>
<p>From within your home folder, open the .m2/settings.xml file and locate the tags. In between these tags place the following
(replacing placeholder myScriptPass with the         same password you used above for the tomcat-script account):</p>
<div class="highlight-python"><pre>&lt;server&gt;
  &lt;id&gt;tomcat-localhost&lt;/id&gt;
  &lt;username&gt;tomcat-script&lt;/username&gt;
  &lt;password&gt;myScriptPass&lt;/password&gt;
&lt;/server&gt;</pre>
</div>
</li>
<li><p class="first">Create the folder: <tt class="docutils literal"><span class="pre">$CATALINA_HOME/waspPlugins</span></tt>
Ensure that their permissions are set such that Maven can copy files into the <tt class="docutils literal"><span class="pre">waspPlugins</span></tt> folder.</p>
</li>
<li><p class="first">To create a startup launch daemon (Debian based instructions):</p>
</li>
<li><p class="first">Type the following at the command line:</p>
<div class="highlight-python"><pre>$ cd $CATALINA_HOME/bin
$ tar xvfz commons-daemon-native.tar.gz
$ cd commons-daemon-1.0.x-native-src/unix
$ ./configure
$ make
$ cp jsvc ../..</pre>
</div>
<ol class="loweralpha simple">
<li>Using your favorite editor and sudo, copy the contents of the file <tt class="docutils literal"><span class="pre">tomcat7-init.d.sh</span></tt> to the location <tt class="docutils literal"><span class="pre">/etc/init.d/tomcat7</span></tt>.</li>
</ol>
<blockquote>
<div><div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Replace the values of the variables under &#8220;local config section&#8221; at the top with values relevant to your setup</p>
</div>
</div></blockquote>
<ol class="loweralpha simple" start="2">
<li>At the command line run:</li>
</ol>
<blockquote>
<div><p>$ chkconfig &#8211;add tomcat7</p>
</div></blockquote>
<ol class="loweralpha simple" start="3">
<li>At the command line run <tt class="docutils literal"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">/etc/init.d/tomcat7</span> <span class="pre">start</span></tt> to start tomcat. You should see a welcome page at
<a class="reference external" href="http://localhost:8080">http://localhost:8080</a> if all went well.</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="installing-building-and-deploying-wasp">
<span id="installing"></span><h3>Installing, Building and Deploying WASP<a class="headerlink" href="#installing-building-and-deploying-wasp" title="Permalink to this headline">¶</a></h3>
<p>There are three main component types comprising the Wasp System as detailed below:</p>
<p>The wasp-web Webapp is deployed on Tomcat and represents the graphial UI for the system. It is part of the central git project</p>
<p>The wasp-damon is an independent software component which leverages Spring Integration and Spring Batch to control task flows and analysis flows.
It responds to messages (via RMI) from the web interface and command line interface (CLI). It maintains its own state and starts up from where it left off after
shutdown (or failure) and restart. This component is also part of the central git project</p>
<p>Plugins are individual git versioned projects that, when built and placed int the &#8216;waspPlugins&#8217; folder under the tomcat home folder, are weaved into the system.
They extend the web and/or daemon components to add new functionality.</p>
<p>The fastet way to get going is to download and run the setupWasp.sh bash script. It clones and installs select projects hosted
on the wasp-system GitHub repository <a class="reference external" href="https://github.com/WASP-System">https://github.com/WASP-System</a>. If you run again later it updates the installation for you taking the lates changes from GitHub.
First it installs the central project into a git managed folder called &#8216;wasp&#8217;, deploys the webapp then clones select plugin projects.  Before running the script,
you must uncomment and set the WASP_HOME and CATALINA_HOME variables at the top of the script if they are
not already set in your environment. You may also wish to uncomment out the lines to shutdown and restart the wasp-daemon application.
After installation is complete, take a look at the <tt class="docutils literal"><span class="pre">$WASP_HOME/wasp-plugins/wasp-config/src/main/resources</span></tt> folder. This is where most custom
properties can be set including the database settings.</p>
<ol class="arabic simple">
<li>Initialize the wasp database by running the following at the command line (remember to edit the database</li>
</ol>
<blockquote>
<div><p>settings in the scripts first if they have been changed in the config):</p>
<div class="highlight-python"><pre>$ mysql -uroot -p &lt; $WASP_HOME/wasp/db/InitializeWaspDb.sql
$ mysql -uroot -p wasp &lt; $WASP_HOME/wasp/db/createSpringBatchTables.sql</pre>
</div>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">Post Installation checks:</p>
<ol class="loweralpha">
<li><p class="first">Check to see that <tt class="docutils literal"><span class="pre">wasp-tomcat-classloader-x.x.x-SNAPSHOT.jar</span></tt> has been copied into the
<tt class="docutils literal"><span class="pre">$CATALINA_HOME/lib</span></tt> folder. If not (due to a permissions issue) you should do this manually:</p>
<div class="highlight-python"><pre>$ sudo cp $WASP_HOME/wasp/wasp-tomcat-classloader/target/wasp-tomcat-classloader-?.?.?-SNAPSHOT.jar $CATALINA_HOME/lib</pre>
</div>
</li>
<li><p class="first">Verify the installed plugins by navigating to <tt class="docutils literal"><span class="pre">$CATALINA_HOME/waspPlugins</span></tt>. Plugins should have been installed here. If
old versions of plugins persist these must be deleted as only one version of each plugin can be present in this folder.</p>
</li>
<li><p class="first">Verify that the wasp system webapp was started by navigating to localhost:8080/wasp in
a local web browser. If you see the login page you have set up the webapp properly. On a Linux system you could also use command-line tool lynx to do this:</p>
<div class="highlight-python"><pre>$ lynx http://localhost:8080/wasp</pre>
</div>
<p>If not already performed by the setupWasp script, you may start up the wasp-daemon executable component (task management) in a new shell as follows:</p>
<div class="highlight-python"><pre>$ cd $WASP_HOME/wasp/wasp-exec
$ java -Xms128m -Xmx256m -XX:PermSize=128m -XX:MaxPermSize=256m \
  -Dcatalina.home=$CATALINA_HOME \
  -cp "target/wasp-exec-0.1.0-SNAPSHOT.jar:$CATALINA_HOME/waspPlugins/*" \
  edu.yu.einstein.wasp.daemon.StartDaemon</pre>
</div>
<p>To run it in the background with no terminal output use this variant of the command instead:</p>
<div class="highlight-python"><pre>$ nohupjava -Xms128m -Xmx256m -XX:PermSize=128m -XX:MaxPermSize=256m \
  -Dcatalina.home=$CATALINA_HOME \
  -cp "target/wasp-exec-0.1.0-SNAPSHOT.jar:$CATALINA_HOME/waspPlugins/*" \
  edu.yu.einstein.wasp.daemon.StartDaemon &gt; /dev/null 2&gt;&amp;1 &amp;</pre>
</div>
</li>
</ol>
</li>
</ol>
</div>
<div class="section" id="building-the-documentation">
<h3>Building the Documentation<a class="headerlink" href="#building-the-documentation" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>The Sphinx documentation (<a class="reference external" href="http://sphinx-doc.org">http://sphinx-doc.org</a>) can be built by running the following commands::</dt>
<dd>$ cd wasp-doc/src/sphinx
$ make html
$ make latexpdf # requires pdftolatex install</dd>
</dl>
<p>Javadoc can be generated by running <tt class="docutils literal"><span class="pre">$</span> <span class="pre">mvn</span> <span class="pre">javadoc:javadoc</span></tt> in any component parent folder, e.g.
<tt class="docutils literal"><span class="pre">WASP_HOME/wasp-web</span></tt> (for the WASP SYSTEM webapp) or <tt class="docutils literal"><span class="pre">$WASP_HOME/wasp-core</span></tt>
(for the core code). The documentation can then be found in <tt class="docutils literal"><span class="pre">target/apidocs</span></tt> folder under the component parent folder.</p>
</div>
</div>
<div class="section" id="core-concepts">
<h2>Core concepts<a class="headerlink" href="#core-concepts" title="Permalink to this headline">¶</a></h2>
<p>Concepts and procedures for working with WASP.</p>
<div class="section" id="data-model">
<h3>Data Model<a class="headerlink" href="#data-model" title="Permalink to this headline">¶</a></h3>
<p>The WASP data model is managed with the object-relational mapping tool <a class="reference external" href="http://hibernate.org/">Hibernate</a>.
Model classes are defined in the package <tt class="docutils literal"><span class="pre">edu.yu.einstein.wasp.model</span></tt>
of the <cite>wasp-core</cite> module. Consult the <a class="reference external" href="http://waspsystem.org/dev/site/apidocs/index.html">JavaDoc</a> for
detailed information regarding the WASP data model.</p>
</div>
<div class="section" id="state">
<h3>State<a class="headerlink" href="#state" title="Permalink to this headline">¶</a></h3>
<p>State is a central concept to dealing with data processing in WASP.
State is managed by a split mechanism within WASP.  The first is a state semaphore system
that is handled through persistence using the WASP <tt class="docutils literal"><span class="pre">State</span></tt> class.  WASP developers
define <tt class="docutils literal"><span class="pre">Task</span></tt>s that represent human intervention tasks that are managed by
<tt class="docutils literal"><span class="pre">State</span></tt>s. A depiction of state transition for the overall Job task is presented
in <a href="#fig-jobtaskstate">figure  3</a>.  In this example, upon creation of a WASP Job, a corresponding
<tt class="docutils literal"><span class="pre">Task</span></tt> is created in the database and it is assigned a <tt class="docutils literal"><span class="pre">State</span></tt> value indicating
that the process is running (running of the process is managed by Spring Batch).
The processing pipeline proceeds through its steps and changes the <tt class="docutils literal"><span class="pre">State</span></tt> to completed
after completion of work. WASP task states are defined by the <tt class="docutils literal"><span class="pre">TaskStatus</span></tt> <tt class="docutils literal"><span class="pre">enum</span></tt>.
The intention is to use these states for all tasks; however, states are persisted through <tt class="docutils literal"><span class="pre">Enum</span></tt>s
allowing developers can create their own states to manage custom <tt class="docutils literal"><span class="pre">Task</span></tt>s
when it becomes necessary.</p>
<div class="figure align-center" id="fig-jobtaskstate">
<img alt="_images/JobTaskState.png" src="_images/JobTaskState.png" style="width: 7cm;" />
<p class="caption">Figure 3: Job Task State.</p>
</div>
<p>All processes defined within WASP are implemented as <a class="reference external" href="http://www.springsource.org/spring-batch&quot;">Spring Batch</a> job flows.  <a href="#fig-taskstate">figure  4</a> presents an
example state diagram where the state of a Spring Batch flow is determined by the <tt class="docutils literal"><span class="pre">State</span></tt> of
a WASP <tt class="docutils literal"><span class="pre">Task</span></tt> designed to manage human interaction related to the flow.</p>
<div class="figure align-center" id="fig-taskstate">
<img alt="_images/TaskState.png" src="_images/TaskState.png" style="width: 14cm;" />
<p class="caption">Figure 4: State transitions for a WASP task to monitor approval of a job by a principal investigator.</p>
</div>
<p>Standard Spring Batch flows are distributed with the system as plugins, and define the standard behavior
of the application.  These flows can be configured for a local instance or even completely replaced.  Any
logic that is particular to a particular institution can be configured by adding custom flow steps.  For example,
the standard web application defines the act of manually approving an invistigator&#8217;s request by a departmental
administrator who checks to see that the investigator has sufficient funds in the grant used to place an order.
This step can be removed and replaced with code that requests funds from an institutional accounting system,
encumbers the funds, and automatically approves the job.  This new functionality may then be overridden in
the web application where tasks can be approved by users with sufficient privileges.</p>
</div>
<div class="section" id="web-functionality">
<h3>Web functionality<a class="headerlink" href="#web-functionality" title="Permalink to this headline">¶</a></h3>
<p>Description of XML definitions of web flows and implementation of custom
controllers.  How to extend.</p>
</div>
<div class="section" id="metadata-system">
<h3>Metadata system<a class="headerlink" href="#metadata-system" title="Permalink to this headline">¶</a></h3>
<p>Description of the WASP key-value data collection system, enforcement via
code and how to extend it.  How to define resources and collect metadata.</p>
</div>
<div class="section" id="analytical-pipelines">
<h3>Analytical Pipelines<a class="headerlink" href="#analytical-pipelines" title="Permalink to this headline">¶</a></h3>
<p>Execution of analytical pipelines: trigger instrument specific pipelines (eg.
Illumina/CASAVA), encapsulate existing tools as tasks (eg. MPS reference based aligners)
or define flows of tasks to generate analytical pipelines.</p>
</div>
<div class="section" id="managing-resources">
<h3>Managing resources<a class="headerlink" href="#managing-resources" title="Permalink to this headline">¶</a></h3>
<p>Loaders, metadata, adding software, sequencers.  Configuring external metadata (genomes, annotations).</p>
</div>
</div>
<div class="section" id="working-with-the-web-layer">
<h2>Working with the web layer<a class="headerlink" href="#working-with-the-web-layer" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Email communication is essential for proper WASP flow, particularly during user registration and initial steps of job submission.
Currently, WASP does NOT provide a backup system if email communication fails. While this will be remedied in a future release,
until that time, it is essential to properly configure the email system and to confirm that emails to and from the system function as expected.</p>
</div>
<div class="section" id="users">
<h3>Users<a class="headerlink" href="#users" title="Permalink to this headline">¶</a></h3>
<p>There exist two general categories of WASP users and the procedure used to create accounts differs for each category.</p>
<p>The two general classes of user are:</p>
<ol class="arabic simple">
<li>Job Submitters</li>
<li>Core Laboratory Personnel and Administrators</li>
</ol>
<p>Job Submitters include Principal Investigators and their lab members who request services from a Core Laboratory Facility.
The function of the Core Laboratory Facility is to provide services to Job Submitters, generally by performing assays and data analysis,
and returning results.</p>
<p>Core Laboratory Personnel and Administrators include individuals directly or indirectly associated with the Core
Laboratory Facility, including Facility Managers, Facility Technicians, Departmental Administrators, General Administrators,
System Administrators, etc. While the two groups of users are not mutually exclusive, the mechanism for creating each account is
different; creating accounts for Job Submitters (PIs and their lab members) generally occurs from outside WASP while creating accounts
for Core Facility Personnel generally occurs from within WASP.</p>
</div>
<div class="section" id="roles">
<h3>Roles<a class="headerlink" href="#roles" title="Permalink to this headline">¶</a></h3>
<p>WASP supports user roles as a means of regulating access to system functionality. Users can be granted no role or
many different roles, which controls what they are able to to do within the system.  For example, a typical job submitter
that registers as a member of some lab is conferred with the role of lab user (LU), which permits that user to submit
job requests, to view ones own job requests and the progress of those jobs, and to view all data associated with those
jobs. A job submitter that registers as a Principal Investigator is conferred with roles PI, LM (lab manager),
and LU (lab user), which permits the PI to submit job requests, view ones own job requests and data generated from
those requests, and to view job requests and data belonging to other lab users registered with that PI&#8217;s lab.</p>
<p>By contrast, the PI, LM, and LU roles are NOT sufficient to permit access Core Laboratory Facility functions, which include the
generation of libraries, the loading of flow cells, and the creation / initiation of a sequencing run, as these functions are
restricted to individuals granted the roles of Facility Manager (FM) and Facility Technician (FT role). Some roles, such as PI
and LU are granted automatically by the system during the registration process; other roles, such as Facility Manager and Technician,
are granted or revoked explicitly (see Super User below). Current roles that can be granted explicitly include Facilities Manager,
System Administrator, General Administrator, Facilities Technician, Lab Manager, and Super User, however the System Administrator
and General Administrator roles have yet to be fully defined. The system also includes a special role, Super User, which permits
access to all WASP functionality.</p>
</div>
<div class="section" id="special-user-role">
<h3>Special User &amp; Role<a class="headerlink" href="#special-user-role" title="Permalink to this headline">¶</a></h3>
<p>WASP is delivered with a single registered user with a username / password combination of super / user and a role of Super User.
The role of Super User confers access to ALL system privileges. Note that other users can be granted the Super User role. It is suggested
that the role of Super User be granted to individuals that in addition have been granted the role of Facility Manager.</p>
</div>
<div class="section" id="logging-in">
<h3>Logging In<a class="headerlink" href="#logging-in" title="Permalink to this headline">¶</a></h3>
<p>To log into WASP, a user requires a valid account, which is obtained through the registration process. Once the registration
process is complete, a user will have obtained a username and password which are required to log in. To log in, point your browser
to the WASP login page, enter your username and password, and click the Login button.</p>
</div>
<div class="section" id="dashboard">
<h3>Dashboard<a class="headerlink" href="#dashboard" title="Permalink to this headline">¶</a></h3>
<p>Navigation through WASP begins at the Dashboard web page, which appears upon successful login. You may return to the
Dashboard at any time by clicking on the WASP &#8220;beehive&#8221; logo or the Dashboard link located on the upper-left or upper-right portion
of each webpage, respectively.</p>
</div>
<div class="section" id="registration">
<h3>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h3>
<div class="section" id="creating-an-account-for-job-submitters">
<h4>Creating An Account For Job Submitters<a class="headerlink" href="#creating-an-account-for-job-submitters" title="Permalink to this headline">¶</a></h4>
<p>WASP is laboratory-based, which helps facilitate data sharing. This means that when a PI creates a new PI account,
they simultaneously create a lab which others (lab members) may join. Because of this, a lab member may not join a lab
until the lab&#8217;s PI has successfully registered. New PIs and new lab members register for a new account from
outside the system by navigating to the WASP login page and selecting the appropriate link (&#8220;New PI&#8221; or New User&#8221;).
Note that the choice of Wasp username is not restricted, however we suggest the format of initial of first name followed
directly by complete last name (no spaces, all lower case). In addition, it is important to pay particular attention to the
email address that is entered in this form, as email is the primary mechanism by which users complete the registration
process and an incorrect email addresses at this time can result in difficult to detect delays.</p>
</div>
<div class="section" id="creating-a-new-pi-account">
<h4>Creating A New PI Account<a class="headerlink" href="#creating-a-new-pi-account" title="Permalink to this headline">¶</a></h4>
<p>For individuals that do NOT have a WASP account and wish to register for a new account as a PI of a particular lab,
the process is as follows. A new PI registers for an account by selecting the &#8220;New PI&#8221; link located on the WASP login page.
Users may choose their own username and password. Once the form is successfully submitted, the new PI will receive an email
asking to confirm his/her email address, which is done by clicking on a link from within the email.</p>
<p>Following email confirmation, someone with the appropriate authority must enter the system and approve or reject
the &#8220;New PI&#8221; request. It is expected that a Department Administrator for the new PI&#8217;s department will be the one to approve
the request, however, any user with Super User privileges may perform this function. The appropriate Department Administrator
will receive an email informing them that a new PI request is awaiting action. To approve or reject a new PI, navigate to
Dashboard/Tasks tab/Department Administration Tasks. Click on the accordion bar to reveal information about the PI and either
accept or reject their application. This results in the new PI receiving an email informing them that their new account has been
rejected or approved; if approved they may log in.</p>
</div>
<div class="section" id="creating-a-new-lab-member-account">
<h4>Creating A New Lab Member Account<a class="headerlink" href="#creating-a-new-lab-member-account" title="Permalink to this headline">¶</a></h4>
<p>For individuals that do NOT have a WASP account and wish to register for a new account as a member of a particular lab,
the process is as follows. Navigate to the WASP login page and select the &#8220;New User&#8221; link. Complete the New User form and submit.
Note that to complete the form, you MUST provide the WASP username of the PI whose lab you wish to join. This implies that the
PI must have an active WASP PI account prior to any lab member registration. Once submitted, the new user will receive an email
requesting that they confirm their email address.</p>
<p>After a pending new user confirms his/her email address, the specified PI (or any designated lab manager assigned to that lab)
will receive an email informing them that a new lab member has requested to join their lab. (To designate a lab manager, see below.)
The email will instruct the PI or lab manager to log in to WASP and accept or reject the new pending lab member. To accept/reject
the new user, The PI or lab manager is expected to log in,  navigate to Dashboard/Tasks tab/Lab Management Tasks link, click on
the accordion bar to reveal information about the prospective lab member, and approve or reject their application. Notification
to the lab member will be by email. If approved, the user can now log in. In addition to the PI or lab manager, any user with
Super User privileges may accept or reject the pending new user.</p>
</div>
<div class="section" id="joining-another-lab">
<h4>Joining Another Lab<a class="headerlink" href="#joining-another-lab" title="Permalink to this headline">¶</a></h4>
<p>This section deals with users that already have a WASP account. The procedure for a registered WASP user to join another
lab is straightforward and does NOT include the creation of a new account. As before, the PI of the other lab must be a
registered WASP user. To join a second (or third) lab, navigate to Dashboard/My Account tab/Request Access To A Lab.
Note that there are two sections to the resulting page, &#8220;Request Access To Lab&#8221; &amp;amp; &#8220;Create New Lab&#8221; Request. To join
another lab as a regular lab member, complete the Request Access To Lab section by typing in the WASP username of the
PI for the lab you wish to join and submit using the Request Access button. The PI (and any Lab Managers) of the specified
lab will receive an email informing them of the request and asking that they log in to WASP and Approve or reject the user&#8217;s
request through the Dashboard/Tasks tab/Lab Management Tasks link. (In addition, any user with Super User privileges may
approve/reject this application.)</p>
<p>The procedure for a registered WASP user to become the PI of a new lab is as follows and does NOT include the
creation of a new account. Navigate to Dashboard/My Account tab/Request Access To A Lab and complete the Create New Lab
Request form in order to apply to become a PI of a new lab. Once submitted, the request will need to be approved by a
Department Administrator or by someone with the role of Super User (see Approving/Rejecting A New PI Account).</p>
</div>
<div class="section" id="creating-an-account-for-core-laboratory-personnel-administrators">
<h4>Creating An Account For Core Laboratory Personnel &amp; Administrators<a class="headerlink" href="#creating-an-account-for-core-laboratory-personnel-administrators" title="Permalink to this headline">¶</a></h4>
<p>While the majority of WASP users are PIs and their lab members who wish to submit job requests,
a smaller number of WASP users include core laboratory personnel, typically a Facility Manager,
Facility Technicians, as well as Department Administrators. Core laboratory personnel do NOT create accounts themselves. Instead,
the creation of accounts for new Core Lab Personnel is restricted to users with the role of Super User. Once an individual
with Super User status has logged in, select the &#8220;Superuser Utils&#8221; tab from the dashboard, followed by the &#8220;User Utils&#8221; link,
which will bring you to a &#8220;List of Users&#8221; grid.  This grid provides access to data about all registered users; access to that
data is through double-clicking an entry. In addition to information about existing users, the grid is used to create a record
for a new core lab user. To create a new user, click in the &#8220;+&#8221; icon located at the bottom left of the grid; the &#8220;Add new row&#8221;
tooltip should appear when you hover over the &#8220;+&#8221; sign.  Complete the &#8220;Add Record&#8221; form that appears and submit. Note that the
choice of Wasp username is not restricted, however we suggest the format of initial of first name followed directly by last name
(no space, all lower case). It is important to pay particular attention to the email address that is entered in this form,
as email is the primary mechanism by which users complete the registration process and an incorrect email addresses at this
time can result in difficult to detect delays.</p>
<p>Once the new record has been submitted, it is strongly suggested that the new user be assigned one or more roles. To
assign a role, return to the dashboard, select the &#8220;Superuser Utils&#8221; tab, then select the &#8220;System Users&#8221; link, which will
take you to the &#8220;System User Management&#8221; page.  Complete the form entitled Add System Role to User located at the bottom of the
page. To do so, select a new role for the user and then indicate the user to which this role is to be applied. To indicate the
user, begin typing the name of that user in the &#8220;Existing User&#8221; textbox. Once 2 - 3 letters of the name have been entered,
autocomplete functionality attached to the text box will generate a set of possible user names. Select the correct user
from the list and submit. (N.B.: You MUST select a user from the autocomplete list rather than simply typing the name of
the user. This is necessary as both the name of the user, and his/her unique WASP username, will appear on the list and are
necessary for proper granting of the new role. If the name does not appear using autocomplete, you most likely introduced a
spelling error. Note that more than one role may be assigned to any user. (For example, as mentioned above, it may be prudent
to assign the roles of Facility Manager and Super User to the individual responsible for the Facility laboratory.)</p>
<p>While the roles of the Facility Manager and Facility Technician appear obvious, that of Departmental Administrator
requires explanation and is applied differently from those described previously. The role of Departmental Administrator
is two-fold: 1) to approve or reject new PI&#8217;s applying for a (new) WASP account and 2) to approve or reject new job
requisitions. It is envisioned that a Departmental Administrator will handle new PI applications and job submission
requests on a department basis.  The system ships with two default departments, &#8216;Internal - Default Department&#8217; and
&#8216;External - Default Department.&#8217;  Additional internal departments (for example, Genetics) may be created and Departmental
Administrators may be assigned to them, although creating a new department requires Super User privileges.  Users are
assigned the role of Department Administrator on a department by department basis. This can occur in one of two ways.
By the first method, a user with Super User privileges navigates to Dashboard, selects the Dept Admin tab, followed by
the Department Management link. At the top of the page resulting page, enter the name of the new department and the name
of the new administrator (must be someone already in WASP). The name of the new Administrator will autocomplete.
Select that person and submit. The second way is to navigate to Dashboard/Dept Admin tab/Department Management link
and then choose a department from the list at the bottom of the page. On the next page, type in the name of the new
Administrator (Administrator Name / Create Administrator), which will autocomplete; submit.</p>
<p>Following the successful submission of the form creating this new user, an email will be sent to the user welcoming
them to WASP, informing them of their WASP username, and asking that they click a link within the email confirming their
email address. (Obviously, if the new user fails to receive this initial email within a reasonable amount of time, it may
be assumed that an incorrect email address was entered on to the initial &#8220;Add Record&#8221; form or the WASP email system failed
to function properly.) Once the user confirms his/her email address, they will receive a second email describing the process
required to reset their password.  Once their password is reset and confirmed, the registration process is complete and the
new core lab user may log in.</p>
</div>
</div>
<div class="section" id="job-submission">
<h3>Job Submission<a class="headerlink" href="#job-submission" title="Permalink to this headline">¶</a></h3>
<p>Submitting a job request is restricted to PIs and lab members. To submit a new job, navigate to dashboard, Job Utils tab,
and select the Submit A Job link. To initiate a new request, complete the Create A Job page. Once this first page is completed,
information about the job is saved, permitting the job request to be completed at some time in the future if desired.
The new (draft) request, while saved by the system, is not visible to the core lab facility until all parts of the request are properly
completed and submitted. If you need to save a job request prior to completion, it can be accessed at any time through dashboard,
Job Utils tab, Draft Jobs link. Complete the initial Create A Job page by providing a name for the job, selecting the lab to be
billed, and selecting the type of assay workflow that should be followed for this particular submission. (An example of a workflow
might be ChiP-Seq or RNA-Seq). The submission continues by requesting information about the type of sequencing machine to be used
for the job, as well as the requested read length and read type. This is followed by the names and types of samples being submitted;
the system accepts new samples will shortly accept samples submitted to previous jobs. Users may also upload files that may be useful
to the Core Lab Facility to document specifics about the samples being submitted (such as the size distribution of a user-submitted
library prep or the quality of an RNA preparation). This is followed by number of sequencing lanes requested and how the samples
should be run on those lanes, the pairings specific for the ChiP-Seq analysis, and finally specific regarding software used
for the alignment and peak calling. Once a job request has been submitted, it may be viewed.</p>
</div>
<div class="section" id="core-lab-functionality">
<h3>Core Lab Functionality<a class="headerlink" href="#core-lab-functionality" title="Permalink to this headline">¶</a></h3>
<p>The following sections describe functionality essential to the core lab.</p>
<div class="section" id="workflow-configuration">
<h4>Workflow Configuration<a class="headerlink" href="#workflow-configuration" title="Permalink to this headline">¶</a></h4>
<p>Types of sequencing jobs (referred to as a workflow) require configuration prior to any job submission. To
configure a workflow requires Super User privileges. Navigate to Dashboard/SuperUser Utils tab and select the Workflow
Utils link. The resulting webpage displays a grid listing available workflows. Select the workflow of interest and
click on its configure link. On the next webpage, select the options most appropriate and submit. Once a workflow is
configured, users may submit job requests of that type of workflow.</p>
</div>
<div class="section" id="create-a-machine-record">
<h4>Create A Machine Record<a class="headerlink" href="#create-a-machine-record" title="Permalink to this headline">¶</a></h4>
<p>Currently, types of machines available to the core facility (such as an Illumina HiSeq 2000) are pulled into
the system from a configuration file.  By contrast, instances of a machine (such as the Illumina HiSeq 2000 machine
in room 202 with serial number 102123) must be input manually. To view the current list of machines and to create a
new machine, navigate to Dashboard/Facility Utils/List All Machines link. To add a new machine, select the &#8220;+&#8221; at the
bottom left of the grid, complete the resulting form, and submit.</p>
</div>
<div class="section" id="create-a-platform-unit-record">
<h4>Create A Platform Unit Record<a class="headerlink" href="#create-a-platform-unit-record" title="Permalink to this headline">¶</a></h4>
<p>Currently, types of platform units (flow cells) available to the core facility (such as Illumina Flow Cell Version 3)
are pulled into the system from a configuration file. Prior to adding libraries to a platform unit, a record for instances of
a platform unit (such as an Illumina Flow Cell Version 3 with barcode AZX102TTA) must be created. To create a new platform unit
record, navigate to Dashboard/Facility Util/List-Create link located under the platform unit utils subsection. After selecting a
type of machine, followed by selecting a type of platform unit, you will see a grid listing the specific instances of platform
units that are already recorded in the system. To generate a new instance of a particular type of platform unit, click the &#8220;+&#8221;
at the bottom left of the grid, complete the form, and submit. To view a virtual display of the platform unit, select &#8220;details&#8221;
from the grid entry of interest.</p>
</div>
<div class="section" id="create-a-control-library">
<h4>Create A Control Library<a class="headerlink" href="#create-a-control-library" title="Permalink to this headline">¶</a></h4>
<p>Control libraries may be added to any lane of a flow cell, regardless of the presence of other libraries on the lane. Controls
are used to gain a feel for the quality of a sequence run as well as for reducing the signal generated from Illumina amplicon libraries
or 5&#8217; indexed Illumina libraries which contain a common sequence at one or both ends of an insert. Controls must be entered into the
WASP database prior to their initial use. To generate a control, navigate to Dashboard/Facility Utils tab/Control Libraries link. Select
the &#8220;Create New Library&#8221; button, fill in the form, and submit. Currently, controls may be added to a flow cell lane whether they
conflict with user&#8217;s libraries or not. This may require remediation.</p>
</div>
</div>
</div>
<div class="section" id="developing-wasp-system-pipelines">
<h2>Developing Wasp System Pipelines<a class="headerlink" href="#developing-wasp-system-pipelines" title="Permalink to this headline">¶</a></h2>
<p>WASP is designed to be flexible in that data processing flows can incorporate steps from other flows,
providing sequencing facilities to tune processing and analysis to their liking and actual environment.  The
standard processing flows are distributed as a guideline; however they may be modified as necessary to meet
individual needs.</p>
<div class="section" id="overview-of-a-standard-chip-seq-flow">
<h3>Overview of a standard ChIP-seq flow<a class="headerlink" href="#overview-of-a-standard-chip-seq-flow" title="Permalink to this headline">¶</a></h3>
<p>The basic design of a massively parallel sequencing flow is presented in <a href="pipelines.html#fig-sequencingflow">figure  6</a>.</p>
<div class="figure align-center" id="fig-sequencingflow">
<img alt="_images/SequencingFlow.png" src="_images/SequencingFlow.png" style="width: 14cm;" />
<p class="caption">Figure 5: Overview of hierarchy of flows to complete a MPS analysis</p>
</div>
<p>Sample handling and analysis flows are configured and initiated by the web application upon successful
submission of a sequencing job.  Flows operate independently and are configured to wait at certain stages until
they are messaged by other flows. The job flow sends a message that an invoice has been generated (1), which is
received by the sample flow.  Independent sample flows for each sample, message their associated library flows (2),
upon completion of library preparation.  When libraries are ready for sequencing, the library flow messages
the library&#8217;s completion (3), and marks them as such in the database.  When the sequencing facility begins an
instrument flow, the completed libraries are presented to the operator who assigns them to platform units
and the flow tracks the sequencing of the libraries.  When result files have been generated, the instrument
flow messages completion (4), the library flow completes (5), and the analysis flow processes the data and
signals final completion (6).</p>
<p>Messages are status messages that do not have a particular destination.  Any component can be configured
to listen to and react to a particular message.  Messages also contain specific information about the status
of the step, e.g. step completion or failure.</p>
</div>
</div>
<div class="section" id="planned-features">
<h2>Planned features<a class="headerlink" href="#planned-features" title="Permalink to this headline">¶</a></h2>
<p>Planned features for the subsequent releases of wasp.</p>
<div class="section" id="api-release">
<h3>API release<a class="headerlink" href="#api-release" title="Permalink to this headline">¶</a></h3>
<p>Finalization of WASP API. Consolidate service layer, refactor project and model objects.</p>
</div>
<div class="section" id="command-line-application">
<h3>Command line application<a class="headerlink" href="#command-line-application" title="Permalink to this headline">¶</a></h3>
<p>Develop command line application using Spring Integration and JMS. Allows the superuser to
perform administrative tasks and regular users to access metadata at the
command line. Will serve as a templatefor users who want to develop applications that interact
with the WASP framework.</p>
</div>
<div class="section" id="wasp-remote-execution">
<h3>WASP remote execution<a class="headerlink" href="#wasp-remote-execution" title="Permalink to this headline">¶</a></h3>
<p>Partition WASP job flows out to grid resources.</p>
</div>
</div>
<div class="section" id="glossary">
<h2>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<p>Glossary of Wasp System terms</p>
<div class="section" id="metadata-glossary">
<h3>Metadata Glossary<a class="headerlink" href="#metadata-glossary" title="Permalink to this headline">¶</a></h3>
<p>Registry of WASP metadata</p>
<dl class="glossary docutils">
<dt id="term-library-fragmentsize">library.fragmentSize</dt>
<dd>Mean fragment size of a library, as recorded by the sequencing facility.</dd>
<dt id="term-library-fragmentsizesd">library.fragmentSizeSD</dt>
<dd>Standard deviation of fragment size of a library, as recorded by the sequencing facility.</dd>
<dt id="term-library-fragmentsize-emperical">library.fragmentSize.emperical</dt>
<dd>Fragment size of a library, as determined from alignment to a reference.</dd>
<dt id="term-library-fragmentsizesd-emperical">library.fragmentSizeSD.emperical</dt>
<dd>Standard deviation of fragment size of a library, as determined from alignment to a reference.</dd>
</dl>
</div>
</div>
<div class="section" id="tasks">
<h2>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h2>
<p>Description of WASP tasks.  WASP Tasks are semaphores between the web application, human interaction (HI) steps,
and the batch processor.</p>
<ul class="simple">
<li>WASP core tasks<ul>
<li>Start Job</li>
<li>This is the only State that is explicitly created by the web application.
This Task indicates to the batch system that a job has been correctly
submitted and is ready for processing.</li>
<li>None.</li>
<li>Create a State with a Task of type &#8220;Start Job&#8221; and a status
of TaskStatus.CREATED.  Start Job States do not have a
parent State.</li>
<li>The batch processor polls for states of this type and will execute the
back-end processing based on collected metadata.</li>
</ul>
</li>
<li>Quote Job<ul>
<li>Created to indicate the progress of sending of the initial quote for a Job
request.</li>
<li>Requires a running batch Job.</li>
<li>Create a State with a Task of type &#8220;Quote Job&#8221; and a status
of TaskStatus.CREATED.</li>
<li>When the quote has been confirmed as sent, the
web/business layer changes the status to TaskStatus.COMPLETED.</li>
<li>The batch processor will advance the state to TaskStatus.FINALIZED and proceed
with flow processing.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="license">
<h2>License<a class="headerlink" href="#license" title="Permalink to this headline">¶</a></h2>
<p>The Wasp System is licensed under the <a class="reference external" href="http://www.gnu.org/licenses/agpl.html">GNU Affer General Public License</a>.</p>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><em>Index</em></a></li>
<li><a class="reference internal" href="py-modindex.html"><em>Module Index</em></a></li>
<li><a class="reference internal" href="search.html"><em>Search Page</em></a></li>
</ul>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="#">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2013, Albert Einstein College of Medicine.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>