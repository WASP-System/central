<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.springframework.org/schema/beans"
	default-autowire="byName"
	xmlns:context="http://www.springframework.org/schema/context"
	xsi:schemaLocation="http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd">
		
	<!-- component scan -->
  	<context:component-scan base-package="edu.yu.einstein.wasp.controller" />

	<!-- import common configuration from core -->
	<import resource="classpath*:META-INF/spring/core-common-config.xml" />
	
	<!-- import configuration for sending messages to wasp-daemon and checking status of batch jobs -->
	<import resource="classpath*:META-INF/spring/batch-integration-common-config.xml" />
	
	<!-- import local security context -->
	<import resource="security-context-local.xml"/>

	<mvc:annotation-driven /> 

	<!-- locale -->
	<mvc:interceptors>
	<bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
     	<property name="paramName"><value>setUserLocale</value></property>
    </bean>
      
    <bean class="edu.yu.einstein.wasp.controller.UserLocaleInterceptor" />            
    
	</mvc:interceptors>
  
	<bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
	<bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />
  
	<!-- Import Tiles-related configuration -->
	<import resource="tiles-context.xml" />

	<bean id="jacksonMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"></bean>
    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
		<property name="messageConverters">
			<list>
				<ref bean="jacksonMessageConverter"/>
			</list>
		</property>
	</bean> 

 
	<!-- Enable file upload functionality for Spring MVC. Set max file size to 10Mb  -->
	<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"> 
		<property name="maxUploadSize" value="10000000" />
	</bean>
 

	<!-- endpoint to submit draft files for processing -->
	<bean id="jobRunnerHost" class="java.net.URI">
    	<constructor-arg index="0" value="http://localhost:18083" />
	</bean>

    
	<!-- spring plugin definitions -->
	<import resource="classpath*:META-INF/spring/plugin-context-web.xml" />


	<!-- extracts plugin's precompiled jsp files --> 
	<bean id="jspSupport" class="edu.yu.einstein.wasp.pluginhandler.WaspPluginSupport">
		<constructor-arg index="0" value="WEB-INF/jsp"/>
		<constructor-arg index="1" value="${catalina.home}/waspPlugins"/>
		<constructor-arg index="2" value="**/*.*"/>
	</bean>
  
  
 </beans>
