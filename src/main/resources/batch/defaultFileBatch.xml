<?xml version="1.0" encoding="UTF-8"?>
<beans
    xsi:schemaLocation=" http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
  http://www.springframework.org/schema/integration
  http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
  http://www.springframework.org/schema/batch
  http://www.springframework.org/schema/batch/spring-batch-2.1.xsd
  http://www.springframework.org/schema/integration/file
  http://www.springframework.org/schema/integration/file/spring-integration-file-2.0.xsd"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:batch="http://www.springframework.org/schema/batch"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:si="http://www.springframework.org/schema/integration"
    xmlns:file="http://www.springframework.org/schema/integration/file"
    xmlns="http://www.springframework.org/schema/beans"
    default-autowire="byName">

  <!-- THIS FILE IS BLANK, BUT USED AS A TEMPLATE 


  /** most effective if filename-regex matches registerfile.filnameRegex **/
  <file:inbound-channel-adapter id="wasp.file.Files" 
        directory="/tmp/t" 
        filename-regex="file.*txt"
        prevent-duplicates="true"
        channel="wasp.file.InputChannel"> 
    <si:poller>
      <si:interval-trigger interval="20000" />
    </si:poller>
  </file:inbound-channel-adapter>


  <si:service-activator input-channel="wasp.file.InputChannel" output-channel="logger">
    <bean class="edu.yu.einstein.wasp.batch.launcher.FileLaunchingMessageHandler" scope="prototype">
        <constructor-arg ref="jobRegistry" />
        <constructor-arg ref="jobLauncher" />
        <constructor-arg ref="jobRepository" />
        <constructor-arg ref="jobOperator" />
       
        <constructor-arg type="java.lang.String"><value>wasp.file.Job</value></constructor-arg> 
    </bean>
  </si:service-activator> 

  /** sample exec on file **/
  <bean class="edu.yu.einstein.wasp.batch.DoCommandFileTasklet" id="wasp.file.AbcFileTasklet" scope="step">
    <property name="filename">
      <value>#{jobParameters['filename']}</value>
    </property>
    <property name="params">
      <list>
        <value>'/tmp/abc.pl'</value>
        <value>'goodbye'</value>
        <value>'#{jobParameters['filename']}'</value>
        <value>'goodbye'</value>
      </list>
    </property>

    /* second timeout for the command to complete */
    <property name="timeout" value="5000" />
  </bean>


  <bean id="wasp.file.RegisterFileStep" parent="parentFileStep">
    <property name="itemProcessor">
      <bean class="edu.yu.einstein.wasp.batch.RegisterFileProcessor">
        <property name="filenameRegex" value=".*file\.(\d*)\.(\d*)\.(\d*).*\.txt$" />

        <property name="matchList">
          <list>
            <value>jobId</value>  /* regex match to $1 */
            <value>runId</value>  /* regex match to $2 */
            <value>sampleId</value>   /* regex match to $3 */
          </list>
        </property>
      </bean>
    </property>
  </bean>
  

  
  <batch:job id="wasp.file.Job" restartable="true">
    <batch:step id="wasp.file.Job0" parent="wasp.file.RegisterFileStep" next="wasp.file.Job1" />
    <batch:step id="wasp.file.Job1">
      <batch:tasklet ref="wasp.file.AbcFileTasklet" />
    </batch:step> 
  </batch:job>

  -->

</beans>

