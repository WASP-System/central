<?xml version="1.0" encoding="UTF-8"?>
<beans
    xsi:schemaLocation=" http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
  http://www.springframework.org/schema/integration
  http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
  http://www.springframework.org/schema/batch
  http://www.springframework.org/schema/batch/spring-batch-2.1.xsd
  http://www.springframework.org/schema/integration/file
  http://www.springframework.org/schema/integration/file/spring-integration-file-2.0.xsd"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:batch="http://www.springframework.org/schema/batch"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:si="http://www.springframework.org/schema/integration"
    xmlns:file="http://www.springframework.org/schema/integration/file"
    xmlns="http://www.springframework.org/schema/beans"
    default-autowire="byName">


  <file:inbound-channel-adapter id="files" 
        directory="/tmp/t" 
        prevent-duplicates="true"
        channel="fileInputChannel"> 
    <si:poller>
      <si:interval-trigger interval="2000" />
    </si:poller>
  </file:inbound-channel-adapter>


  <si:service-activator input-channel="fileInputChannel" output-channel="logger">
    <bean class="edu.yu.einstein.wasp.batch.launcher.FileLaunchingMessageHandler" scope="prototype">
        <constructor-arg ref="jobRegistry" />
        <constructor-arg ref="jobLauncher" />
        <constructor-arg ref="jobRepository" />
        <constructor-arg ref="jobOperator" />
       
        <constructor-arg type="java.lang.String"><value>fileJob</value></constructor-arg> 
    </bean>
  </si:service-activator> 

  <bean class="edu.yu.einstein.wasp.batch.DoCommandFileTasklet" id="abcFileTasklet" scope="step">
    <property name="filename">
      <value>#{jobParameters['filename']}</value>
    </property>
    <property name="params">
      <list>
        <value>'/tmp/abc.pl'</value>
        <value>'goodbye'</value>
        <value>'#{jobParameters['filename']}'</value>
        <value>'goodbye'</value>
      </list>
    </property>

    <!-- 5 second timeout for the command to complete -->
    <property name="timeout" value="5000" />
  </bean>

  
  <batch:job id="fileJob" restartable="true">
    <batch:step id="abcFileTaskStep">
      <batch:tasklet ref="abcFileTasklet" />
    </batch:step> 

  </batch:job>


<!--
  <si:inbound-channel-adapter ref="startJobPoller" method="getStates" channel="jobCreateRequestChannel">
    <si:poller>
      <si:interval-trigger interval="5000" />
    </si:poller>
  </si:inbound-channel-adapter>

  <si:service-activator input-channel="jobCreateRequestChannel" output-channel="logger">
    <bean class="edu.yu.einstein.wasp.batch.StateJobLaunchingMessageHandler" scope="prototype">
       <constructor-arg ref="jobRegistry" />
       <constructor-arg ref="jobLauncher" />
       <constructor-arg ref="jobRepository" />
       <constructor-arg ref="jobOperator" />
       <constructor-arg type="java.lang.String"><value>fileJob</value></constructor-arg> 
    </bean>
  </si:service-activator> 
-->

</beans>

