<?xml version="1.0" encoding="UTF-8"?>
<beans xsi:schemaLocation=" http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd     
  http://www.springframework.org/schema/context  
  http://www.springframework.org/schema/context/spring-context-3.1.xsd 
  http://www.springframework.org/schema/mvc 
  http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd  
  http://www.springframework.org/schema/aop 
  http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
  http://www.springframework.org/schema/tx
  http://www.springframework.org/schema/tx/spring-tx-3.1.xsd
  http://www.springframework.org/schema/integration
  http://www.springframework.org/schema/integration/spring-integration-2.0.xsd
  http://www.springframework.org/schema/integration/file
  http://www.springframework.org/schema/integration/file/spring-integration-file-2.0.xsd"
   
  xmlns:mvc="http://www.springframework.org/schema/mvc"  
  xmlns:aop="http://www.springframework.org/schema/aop" 
  xmlns:context="http://www.springframework.org/schema/context" 
  xmlns:p="http://www.springframework.org/schema/p" 
  xmlns:tx="http://www.springframework.org/schema/tx"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:si="http://www.springframework.org/schema/integration"
  xmlns:file="http://www.springframework.org/schema/integration/file"  
  xmlns="http://www.springframework.org/schema/beans"
  default-autowire="byName">

<!--  configure properties files -->
  <bean id="propertyPlaceholderConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">  
    <property name="locations">  
      <list>  
        <value>classpath:database.properties</value>  
        <value>classpath:authentication.properties</value>
        <value>classpath:email.properties</value>
      </list>  
    </property>  
  </bean>  

  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
    <property name="driverClassName"><value>${db.driver}</value></property>
    <property name="url"><value>${db.url}</value></property>
    <property name="username"><value>${db.username}</value></property>
    <property name="password"><value>${db.password}</value></property>
  </bean>


  <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
    <property name="persistenceUnitName" value="waspPU" />
    <property name="dataSource" ref="dataSource" />
    <property name="jpaVendorAdapter">
      <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="database" value="MYSQL" />
        <property name="showSql" value="true" />
      </bean>
    </property>   
  </bean>

  <bean name="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="entityManagerFactory" />
  </bean>

  <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" /> 
        
  <!-- Enable @Transactional support -->
  <tx:annotation-driven transaction-manager="transactionManager" />


  <!-- the application context definition for the DispatcherServlet -->

  <context:component-scan base-package="util.spring" />
  <context:component-scan base-package="edu.yu.einstein.wasp.dao.impl" />
  <context:component-scan base-package="edu.yu.einstein.wasp.service.impl" />
  <context:component-scan base-package="edu.yu.einstein.wasp.controller" />
  <context:component-scan base-package="edu.yu.einstein.wasp.load" />

  <context:annotation-config/>

  <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
  <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />


  <mvc:annotation-driven /> 

  <!-- bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">  
    <property name="viewClass" value="org.springframework.web.servlet.view.JstlView" />
    <property name="prefix" value="/WEB-INF/jsp/" />
    <property name="suffix" value=".jsp" />
    <property name="contentType" value="text/html;charset=UTF-8" />           
  </bean-->

<bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver">
  <property name="viewClass" value="org.springframework.web.servlet.view.tiles2.WaspTilesView"/>
</bean>


  <!-- locale -->
  <mvc:interceptors>
    <bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
     	<property name="paramName"><value>setUserLocale</value></property>
    </bean>
      
    <bean class="edu.yu.einstein.wasp.controller.UserLocaleInterceptor" />            
    
  </mvc:interceptors>

  <bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver" >  
    <property name="defaultLocale" ref="usLocale"/>
  </bean>
  
  <bean id="usLocale" class="java.util.Locale" >  
     <constructor-arg value="en"/>
	 <constructor-arg value="US"/>
  </bean>

  <bean id="messageSource" class="edu.yu.einstein.wasp.service.impl.WaspMessageSourceImpl" >
  	<!-- property name="useCodeAsDefaultMessage" value="true"/-->
  </bean>
  
  <!--  bean id="messageSource"
       class="org.springframework.context.support.ResourceBundleMessageSource">
    <property name="basenames">
      <list>
        <value>messages</value>
      </list>
    </property>
  </bean-->
  


  <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
    <property name="host" value="${email.host}"/>
    <property name="defaultEncoding" value="${email.encoding}" />       
    <property name="javaMailProperties">
      <props>
        <prop key="mail.smtp.from">${email.smtp.from}</prop>      
      </props>        
    </property>
  </bean>


   <bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
      <property name="velocityProperties">
         <value>
          resource.loader=class
          class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
         </value>
      </property>
   </bean>

   <!-- Import Tiles-related configuration -->
   <import resource="tiles-context.xml" />

   <bean id="jacksonMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"></bean>

    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
    <property name="messageConverters">
    <list>
       <ref bean="jacksonMessageConverter"/>
    </list>
  </property>
</bean> 

 
 <!-- Enable file upload functionality for Spring MVC. Set max file size to 10Mb  -->
 <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"> 
        <property name="maxUploadSize" value="10000000" />
 </bean>
 
 <!-- root of the dir structure to store sample draft files upload via "manage sample draft" admin screen  -->  
<bean id="sampleDir" class="java.io.File">
    <constructor-arg index="0" value="C:\apps\tomcat70eintstein\temp" />
</bean>

<!-- endpoint to submit draft files for processing -->
<bean id="jobRunnerHost" class="java.net.URI">
    <constructor-arg index="0" value="http://localhost:18083" />
</bean>


  <!-- Spring Integration/Batch config-->
  <!-- 
  <import resource="spring-integration-batch.xml" />
  <import resource="bee-job-filepoller.xml" />
  <import resource="bee-job-fileproccessor.xml" />
    -->

  <!-- load --> 
  <import resource="classpath*:wasp/*Load.xml" />

</beans>


