<?xml version="1.0" encoding="UTF-8"?>
<beans xsi:schemaLocation=" http://www.springframework.org/schema/beans 
  http://www.springframework.org/schema/beans/spring-beans-3.1.xsd     
  http://www.springframework.org/schema/context  
  http://www.springframework.org/schema/context/spring-context-3.1.xsd 
  http://www.springframework.org/schema/mvc 
  http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd  
  http://www.springframework.org/schema/aop 
  http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
  http://www.springframework.org/schema/tx
  http://www.springframework.org/schema/tx/spring-tx-3.1.xsd" 
  xmlns:mvc="http://www.springframework.org/schema/mvc"  
  xmlns:aop="http://www.springframework.org/schema/aop" 
  xmlns:context="http://www.springframework.org/schema/context" 
  xmlns:p="http://www.springframework.org/schema/p" 
  xmlns:tx="http://www.springframework.org/schema/tx"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns="http://www.springframework.org/schema/beans"
  default-autowire="byName">


  <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
    <property name="driverClassName"><value>com.mysql.jdbc.Driver</value></property>
    <property name="url"><value>jdbc:mysql://localhost:3306/wasp</value></property>
    <property name="username"><value>wasp</value></property>
    <property name="password"><value>waspV2</value></property>
  </bean>


  <!--
  <bean id="cacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
    <property name="configLocation" value="/WEB-INF/ehcache.xml"/>
  </bean>
      
  <bean id="userCacheBackend" class="org.springframework.cache.ehcache.EhCacheFactoryBean">
    <property name="cacheManager" ref="cacheManager"/>
    <property name="cacheName" value="userCache"/>
  </bean>

  <bean id="userCache" class="org.springframework.security.core.userdetails.cache.EhCacheBasedUserCache">
    <property name="cache" ref="userCacheBackend"/>
  </bean>
  -->

  <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean">
    <property name="persistenceUnitName" value="waspPU" /> 
  </bean>

  <bean name="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
    <property name="entityManagerFactory" ref="entityManagerFactory" />
  </bean>


  <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" /> 
        
  <!-- Enable @Transactional support -->
  <tx:annotation-driven transaction-manager="transactionManager" />


  <!-- the application context definition for the springapp DispatcherServlet -->

  <context:component-scan base-package="edu.yu.einstein.wasp.dao.impl" />
  <context:component-scan base-package="edu.yu.einstein.wasp.service.impl" />
  <context:component-scan base-package="edu.yu.einstein.wasp.controller" />
  <context:annotation-config/>

  <bean class="org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping" />
  <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter" />


  <mvc:annotation-driven /> 

  <!-- bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">  
    <property name="viewClass" value="org.springframework.web.servlet.view.JstlView" />
    <property name="prefix" value="/WEB-INF/jsp/" />
    <property name="suffix" value=".jsp" />
    <property name="contentType" value="text/html;charset=UTF-8" />           
  </bean-->

<bean id="viewResolver" class="org.springframework.web.servlet.view.UrlBasedViewResolver">
  <property name="viewClass" value="org.springframework.web.servlet.view.tiles2.TilesView"/>
</bean>


  <!-- locale -->
  <mvc:interceptors>
    <bean class="org.springframework.web.servlet.i18n.LocaleChangeInterceptor">
     	<property name="paramName"><value>setUserLocale</value></property>
    </bean>
      
    <bean class="edu.yu.einstein.wasp.controller.UserLocaleInterceptor" />            
    
  </mvc:interceptors>

  <bean id="localeResolver" class="org.springframework.web.servlet.i18n.SessionLocaleResolver" >  
    <property name="defaultLocale" ref="usLocale"/>
  </bean>
  
  <bean id="usLocale" class="java.util.Locale" >  
     <constructor-arg value="en"/>
	 <constructor-arg value="US"/>
  </bean>

  <bean id="messageSource"
       class="org.springframework.context.support.ResourceBundleMessageSource">
    <property name="basenames">
      <list>
        <value>messages</value>
      </list>
    </property>
  </bean>


   <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl">
      <property name="host" value="localhost"/>
      <property name="defaultEncoding" value="UTF-8" />       
      <property name="javaMailProperties">
       		<props>
               <prop key="mail.smtp.from">ewah@ewah.com</prop>      
            </props>        
      </property>
   </bean>


   <bean id="velocityEngine" class="org.springframework.ui.velocity.VelocityEngineFactoryBean">
      <property name="velocityProperties">
         <value>
          resource.loader=class
          class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
         </value>
      </property>
   </bean>

   <!-- Import Tiles-related configuration -->
   <import resource="tiles-context.xml" />

   <bean id="jacksonMessageConverter" class="org.springframework.http.converter.json.MappingJacksonHttpMessageConverter"></bean>

    <bean class="org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter">
    <property name="messageConverters">
    <list>
       <ref bean="jacksonMessageConverter"/>
    </list>
  </property>
</bean> 
</beans>
