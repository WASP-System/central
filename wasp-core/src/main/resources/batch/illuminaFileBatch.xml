<?xml version="1.0" encoding="UTF-8"?>
<beans
    xsi:schemaLocation=" http://www.springframework.org/schema/beans
  http://www.springframework.org/schema/beans/spring-beans.xsd
  http://www.springframework.org/schema/integration
  http://www.springframework.org/schema/integration/spring-integration.xsd
  http://www.springframework.org/schema/batch
  http://www.springframework.org/schema/batch/spring-batch.xsd
  http://www.springframework.org/schema/integration/file
  http://www.springframework.org/schema/integration/file/spring-integration-file.xsd"
    xmlns:p="http://www.springframework.org/schema/p"
    xmlns:batch="http://www.springframework.org/schema/batch"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:si="http://www.springframework.org/schema/integration"
    xmlns:file="http://www.springframework.org/schema/integration/file"
    xmlns="http://www.springframework.org/schema/beans"
    default-autowire="byName">


  <!-- most effective if filename-regex matches registerfile.filnameRegex -->
  <file:inbound-channel-adapter id="illumina.file.Files" 
        directory="/tmp/t" 
        filename-regex="file.*txt"
        prevent-duplicates="true"
        channel="illumina.file.InputChannel"> 
    <si:poller>
      <si:interval-trigger interval="20000" />
    </si:poller>
  </file:inbound-channel-adapter>


  <si:service-activator input-channel="illumina.file.InputChannel" output-channel="logger">
    <bean class="edu.yu.einstein.wasp.batch.launcher.FileLaunchingMessageHandler" scope="prototype">
        <constructor-arg ref="jobRegistry" />
        <constructor-arg ref="jobLauncher" />
        <constructor-arg ref="jobRepository" />
        <constructor-arg ref="jobOperator" />
       
        <constructor-arg type="java.lang.String"><value>illumina.file.Job</value></constructor-arg> 
    </bean>
  </si:service-activator> 


  <bean id="illumina.file.RegisterFileStep" parent="parentFileStep">
    <property name="itemProcessor">
      <bean class="edu.yu.einstein.wasp.batch.RegisterFileProcessor">
        <property name="filenameRegex" value=".*file\.(\d*)\.(\d*).*\.txt$" />

        <property name="matchList">
          <list>
            <value>runId</value> 
            <value>sampleId</value>  
          </list>
        </property>
      </bean>
    </property>
  </bean>
  

  <batch:job id="illumina.file.Job" restartable="true">
    <batch:step id="illumina.file.Job0" parent="illumina.file.RegisterFileStep" />
  </batch:job>


</beans>

